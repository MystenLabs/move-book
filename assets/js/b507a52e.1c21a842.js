"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7278],{2244:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"storage/transfer-to-object","title":"Receiving as Object","description":"Address owned Object state supports two types of owners: an","source":"@site/../book/storage/transfer-to-object.md","sourceDirName":"storage","slug":"/storage/transfer-to-object","permalink":"/storage/transfer-to-object","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"bookSidebar","previous":{"title":"7.5. UID and ID","permalink":"/storage/uid-and-id"},"next":{"title":"Advanced Programmability","permalink":"/programmability/"}}');var i=t(2714),r=t(4811);const o={},c="Receiving as Object",a={},d=[{value:"Definition",id:"definition",level:2},{value:"Example",id:"example",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Links",id:"links",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"receiving-as-object",children:"Receiving as Object"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/storage/storage-functions#transfer",children:"Address owned"})," Object state supports two types of owners: an\naccount and another Object. If an object was transferred to another object, Sui provides a way to\n",(0,i.jsx)(n.em,{children:"receive"})," this object through its owner's ",(0,i.jsx)(n.a,{href:"/storage/uid-and-id",children:(0,i.jsx)(n.code,{children:"UID"})}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["This feature is also known as ",(0,i.jsx)(n.em,{children:'"Transfer to Object"'})," or TTO."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"definition",children:"Definition"}),"\n",(0,i.jsxs)(n.p,{children:["Receiving functionality is implemented in the ",(0,i.jsx)(n.a,{href:"https://docs.sui.io/references/framework/sui_sui/transfer",children:(0,i.jsx)(n.code,{children:"sui::transfer"})})," module. It consists of a\nspecial type ",(0,i.jsx)(n.code,{children:"Receiving"})," which is instantiated through a special transaction argument, and the\n",(0,i.jsx)(n.code,{children:"receive"})," function which takes a ",(0,i.jsx)(n.a,{href:"/storage/uid-and-id",children:(0,i.jsx)(n.code,{children:"UID"})})," of the parent."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Currently, ",(0,i.jsx)(n.code,{children:"T"})," in the ",(0,i.jsx)(n.code,{children:"transfer::receive"})," is a subject to ",(0,i.jsx)(n.a,{href:"/storage/internal-constraint",children:"Internal Constraint"}),". Public\nversion of ",(0,i.jsx)(n.code,{children:"receive"})," is called ",(0,i.jsx)(n.code,{children:"public_receive"}),", and like other [storage functions][storage-funs]\nit requires ",(0,i.jsx)(n.code,{children:"T"})," to have ",(0,i.jsx)(n.a,{href:"/storage/store-ability",children:(0,i.jsx)(n.code,{children:"store"})}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-move",children:"module sui::transfer;\n\n// An ephemeral wrapper around `Receiving` argument. Provided as a special input\n// in a Transaction Block.\n// Note: this type should be explicitly imported to be used!\npublic struct Receiving<phantom T: key> has drop {\n    id: ID,\n    version: u64,\n}\n\n/// Receive `T` from parent `UID` through special type `Receiving`.\npublic fun receive<T: key>(parent: &mut UID, to_receive: Receiving<T>): T;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Due to the ",(0,i.jsx)(n.code,{children:"UID"})," type requirement, receiving cannot be performed on an arbitrary object that does\nnot provide access or special receiving implementation. This feature should be used be used with\ncaution and in a controlled setting."]}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(n.p,{children:["As an illustration for ",(0,i.jsx)(n.em,{children:"transfer"})," and ",(0,i.jsx)(n.em,{children:"receive"})," consider an example: ",(0,i.jsx)(n.code,{children:"PostOffice"})," allows registering\nPost Boxes and sending to accounts' post boxes."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-move",metastring:"file=packages/samples/sources/storage/transfer-to-object.move anchor=main",children:"module book::receiving;\n\nuse sui::derived_object;\nuse sui::transfer::Receiving; // not imported by default!\n\n/// Base derivation object to create derived `PostBox`-es.\npublic struct PostOffice has key { id: UID }\n\n/// Object with derived UID which receives objects sent to an address.\npublic struct PostBox has key { id: UID, owner: address }\n\n/// Transfer functionality. Anyone can come to the PostOffice and send to a specific\n/// recipient's PostBox. Items can be received from the `PostBox` by the recipient.\npublic fun send<T: key + store>(office: &PostOffice, parcel: T, recipient: address) {\n    let postbox = derived_object::derive_address(office.id.to_inner(), recipient);\n    transfer::public_transfer(parcel, postbox)\n}\n\n/// Receive the parcel. Requires the sender to be the owner of the `PostBox`!\npublic fun receive<T: key + store>(\n    box: &mut PostBox,\n    to_receive: Receiving<T>,\n    ctx: &TxContext\n): T {\n    assert!(box.owner == ctx.sender());\n\n    // Receive `to_receive` from `PostBox`.\n    let parcel = transfer::public_receive(&mut box.id, to_receive);\n    parcel\n}\n\n/// If user hasn't claimed their `PostBox` yet, create it.\n/// Note: this is not a requirement for transferring assets!\n/// Parcels can be sent even to unregistered post boxes, see `send` implementation.\npublic fun register_address(office: &mut PostOffice, ctx: &mut TxContext) {\n    transfer::share_object(PostBox {\n        id: derived_object::claim(&mut office.id, ctx.sender()),\n        owner: ctx.sender()\n    })\n}\n\n// Create a PostOffice on module publish.\nfun init(ctx: &mut TxContext) {\n    transfer::share_object(PostOffice { id: object::new(ctx) });\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,i.jsxs)(n.p,{children:["Transferring to objects is a powerful feature which allows objects to act as owners of other\nobjects. One of the reasons to use it is the extra authorization performed upon receiving, eg the\n",(0,i.jsx)(n.code,{children:"PostOffice"})," in the example above could charge a receiving fee."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Allows parallel execution of transfers to multiple objects without referencing them in the\ntransaction;"}),"\n",(0,i.jsx)(n.li,{children:"Parent objects can also be transferred, acting as a container;"}),"\n",(0,i.jsx)(n.li,{children:"PostBox-like applications, where user gets assets only after activating their account;"}),"\n",(0,i.jsx)(n.li,{children:"Account abstraction-like applications where an object is mocking an account."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.sui.io/concepts/transfers/transfer-to-object",children:"Transfer to Object"})," in Sui\nDocumentation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://docs.sui.io/references/framework/sui_sui/transfer",children:(0,i.jsx)(n.code,{children:"sui::transfer"})})," module documentation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},4811:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>c});var s=t(9378);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);