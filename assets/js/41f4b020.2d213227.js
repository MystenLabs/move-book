"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[9620],{3398:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"storage/uid-and-id","title":"UID and ID","description":"The use of the UID type is required by the Sui Verifier on all types that have the","source":"@site/../book/storage/uid-and-id.md","sourceDirName":"storage","slug":"/storage/uid-and-id","permalink":"/storage/uid-and-id","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"bookSidebar","previous":{"title":"7.4. Storage Functions","permalink":"/storage/storage-functions"},"next":{"title":"7.6. Receiving as Object","permalink":"/storage/transfer-to-object"}}');var s=i(3420),r=i(5521);const d={},o="UID and ID",a={},c=[{value:"Definition",id:"definition",level:2},{value:"Fresh UID Generation",id:"fresh-uid-generation",level:2},{value:"UID Derivation",id:"uid-derivation",level:2},{value:"UID Lifecycle",id:"uid-lifecycle",level:2},{value:"Keeping the UID",id:"keeping-the-uid",level:2},{value:"Proof of Deletion",id:"proof-of-deletion",level:2},{value:"ID",id:"id",level:2},{value:"Fresh Object Address",id:"fresh-object-address",level:2},{value:"Links",id:"links",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"uid-and-id",children:"UID and ID"})}),"\n",(0,s.jsxs)(n.p,{children:["The use of the ",(0,s.jsx)(n.code,{children:"UID"})," type is required by the Sui Verifier on all types that have the\n",(0,s.jsx)(n.a,{href:"/storage/key-ability",children:(0,s.jsx)(n.code,{children:"key"})})," ability. Here we go deeper into ",(0,s.jsx)(n.code,{children:"UID"})," and its usage."]}),"\n",(0,s.jsx)(n.h2,{id:"definition",children:"Definition"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"UID"})," type is defined in the ",(0,s.jsx)(n.code,{children:"sui::object"})," module and is a wrapper around an ",(0,s.jsx)(n.code,{children:"ID"})," which, in\nturn, wraps the ",(0,s.jsx)(n.code,{children:"address"})," type. The UIDs on Sui are guaranteed to be unique, and can't be reused\nafter the object was deleted."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-move",children:"module sui::object;\n\n/// UID is a unique identifier of an object\npublic struct UID has store {\n    id: ID\n}\n\n/// ID is a wrapper around an address\npublic struct ID has store, drop {\n    bytes: address\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"fresh-uid-generation",children:"Fresh UID Generation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"UID"})," is ",(0,s.jsx)(n.em,{children:"derived"})," from the ",(0,s.jsx)(n.code,{children:"tx_hash"})," and an ",(0,s.jsx)(n.code,{children:"index"})," which is incremented for each new UID."]}),"\n",(0,s.jsxs)(n.li,{children:["The ",(0,s.jsx)(n.code,{children:"derive_id"})," function is implemented in the ",(0,s.jsx)(n.code,{children:"sui::tx_context"})," module, and that is why\n",(0,s.jsx)(n.a,{href:"/programmability/transaction-context",children:"TxContext"})," is required for ",(0,s.jsx)(n.code,{children:"UID"})," generation."]}),"\n",(0,s.jsx)(n.li,{children:"Sui Verifier will not allow using a UID that wasn't created in the same function. That prevents\nUIDs from being pre-generated or reused after the object was unpacked."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["New UID is created with the ",(0,s.jsx)(n.code,{children:"object::new"})," function. It takes a mutable reference to ",(0,s.jsx)(n.code,{children:"TxContext"}),", and\nreturns a new ",(0,s.jsx)(n.code,{children:"UID"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-move",children:"public fun uid(ctx: &mut TxContext) {\n  let id = object::new(ctx); // Create a fresh UID from TxContext.\n  id.delete(); // Delete the UID.\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"UID"})," acts as a representation of an object, and allows defining behaviors and features of an\nobject. One of the key features - ",(0,s.jsx)(n.a,{href:"./../programmability/dynamic-fields",children:"Dynamic Fields"})," - is\npossible because of the ",(0,s.jsx)(n.code,{children:"UID"})," type being explicit. Additionally, it allows receiving objects sent to\nother objects. This feature is called ",(0,s.jsx)(n.a,{href:"/storage/transfer-to-object",children:"Transfer to Object (TTO)"}),", and we\nwill explain later in this chapter."]}),"\n",(0,s.jsx)(n.h2,{id:"uid-derivation",children:"UID Derivation"}),"\n",(0,s.jsxs)(n.p,{children:["Sui allows deriving UID's from other UIDs using ",(0,s.jsx)(n.em,{children:"derivation keys"}),". This functionality is implemented\nin the ",(0,s.jsx)(n.a,{href:"https://docs.sui.io/references/framework/sui_sui/derived_object",children:(0,s.jsx)(n.code,{children:"sui::derived_object"})})," module and allows generating predictable and\ndeterministic ",(0,s.jsx)(n.code,{children:"UIDs"})," for easier off-chain discovery. UID for each pair of parent + key can be\ngenerated only once!"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-move",children:"use sui::derived_object;\n\n/// Some central application object.\npublic struct Base has key { id: UID }\n\n/// Derived Object.\npublic struct Derived has key { id: UID }\n\n/// Create and share a new Derived object using `address` as a `key`.\npublic fun derive(base: &mut Base, key: address) {\n    let id = derived_object::claim(&mut base.id, key);\n    transfer::share_object(Derived { id })\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Derived addresses reduce the load on off-chain indexers, since it is enough to store the ID of the\nparent object and get derived IDs using a derivation function. ID derivation function is part of the\nmost SDKs, and also present in Move:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-move",children:"module sui::derived_object;\n\n/// Checks if a UID was derived with `key` at `parent`.\npublic fun exists<K: copy + drop + store>(parent: &UID, key: K): bool;\n\n/// Derive inner `address` of a UID, regardless of whether it was created.\npublic fun derive_address<K: copy + drop + store>(parent: ID, key: K): address;\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The same derivation functionality is used to generate UIDs for\n",(0,s.jsx)(n.a,{href:"/programmability/dynamic-fields",children:"dynamic fields"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"uid-lifecycle",children:"UID Lifecycle"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"UID"})," type is created with the ",(0,s.jsx)(n.code,{children:"object::new"})," function, and deleted with the ",(0,s.jsx)(n.code,{children:"object::delete"}),"\nfunction. The ",(0,s.jsx)(n.code,{children:"object::delete"})," consumes the UID ",(0,s.jsx)(n.em,{children:"by value"}),", hence, it is only possible to delete\nobject's UID after the object ",(0,s.jsx)(n.a,{href:"/move-basics/struct#unpacking-a-struct",children:"was unpacked"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-move",children:"public struct Character has key { id: UID }\n\npublic fun character(ctx: &mut TxContext) {\n    // Instantiate `Character` object.\n    let char = Character { id: object::new(ctx) };\n\n    // Unpack object to get its UID.\n    let Character { id } = char;\n\n    // Delete the UID.\n    id.delete();\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"keeping-the-uid",children:"Keeping the UID"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"UID"})," does not need to be deleted immediately after the object struct is unpacked. Sometimes it\nmay carry ",(0,s.jsx)(n.a,{href:"./../programmability/dynamic-fields",children:"Dynamic Fields"})," or objects transferred to it via\n",(0,s.jsx)(n.a,{href:"/storage/transfer-to-object",children:"Transfer To Object"}),". In such cases, the UID may be kept and stored in a\nseparate object."]}),"\n",(0,s.jsx)(n.h2,{id:"proof-of-deletion",children:"Proof of Deletion"}),"\n",(0,s.jsxs)(n.p,{children:["The ability to return the UID of an object may be utilized in pattern called ",(0,s.jsx)(n.em,{children:"proof of deletion"}),". It\nis a rarely used technique, but it may be useful in some cases, for example, the creator or an\napplication may incentivize the deletion of an object by exchanging the deleted IDs for some reward."]}),"\n",(0,s.jsx)(n.p,{children:'In framework development this method could be used to ignore / bypass certain restrictions on\n"taking" the object. If there\'s a container that enforces certain logic on transfers, like Kiosk\ndoes, there could be a special scenario of skipping the checks by providing a proof of deletion.'}),"\n",(0,s.jsx)(n.p,{children:"This is one of the open topics for exploration and research, and it may be used in various ways."}),"\n",(0,s.jsx)(n.h2,{id:"id",children:"ID"}),"\n",(0,s.jsxs)(n.p,{children:["When talking about ",(0,s.jsx)(n.code,{children:"UID"})," we should also mention the ",(0,s.jsx)(n.code,{children:"ID"})," type. It is a wrapper around the ",(0,s.jsx)(n.code,{children:"address"}),"\ntype, and is used to represent an address-pointer. Usually, ",(0,s.jsx)(n.code,{children:"ID"})," is used to point at an object,\nhowever, there is no restriction, and no guarantee that the ",(0,s.jsx)(n.code,{children:"ID"})," points to an existing object."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["ID can be received as a transaction argument in a\n",(0,s.jsx)(n.a,{href:"./../concepts/what-is-a-transaction",children:"Transaction Block"}),". Alternatively, ID can be created from an\n",(0,s.jsx)(n.code,{children:"address"})," value using ",(0,s.jsx)(n.code,{children:"to_id()"})," function."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-move",children:"public fun conversion_methods(ctx: &mut TxContext) {\n    let uid: UID = object::new(ctx);\n    let id: ID = uid.to_inner();\n\n    let addr_from_uid: address = uid.to_address();\n    let addr_from_id: address = id.to_address();\n\n    uid.delete();\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This example demonstrates different conversion methods: ",(0,s.jsx)(n.code,{children:"UID.to_inner"})," creates a copy of underlying\n",(0,s.jsx)(n.code,{children:"ID"}),", and ",(0,s.jsx)(n.code,{children:"UID.to_address"})," returns inner address. Another often useful method ",(0,s.jsx)(n.code,{children:"ID.to_address"})," copies\ninner value from the ",(0,s.jsx)(n.code,{children:"ID"})," type."]}),"\n",(0,s.jsx)(n.h2,{id:"fresh-object-address",children:"Fresh Object Address"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"/programmability/transaction-context",children:(0,s.jsx)(n.code,{children:"TxContext"})})," provides the ",(0,s.jsx)(n.code,{children:"fresh_object_address"}),"\nfunction which can be utilized to create unique addresses and ",(0,s.jsx)(n.code,{children:"ID"})," - it may be useful in some\napplication that assign unique identifiers to user actions - for example, an order_id in a\nmarketplace."]}),"\n",(0,s.jsx)(n.h2,{id:"links",children:"Links"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.sui.io/references/framework/sui_sui/object",children:(0,s.jsx)(n.code,{children:"sui::object"})})," module documentation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.sui.io/references/framework/sui_sui/derived_object",children:(0,s.jsx)(n.code,{children:"sui::derived_object"})})," module documentation"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.sui.io/concepts/sui-move-concepts/derived-objects",children:"Derived Objects"})," in Sui\nDocumentation"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},5521:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>o});var t=i(6672);const s={},r=t.createContext(s);function d(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);