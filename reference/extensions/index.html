<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-reference docs-version-current docs-doc-page docs-doc-id-extensions" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Module Extensions | Reference | The Move Book</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://move-book.com/reference/extensions"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="algolia-site-verification" content="BCA21DA2879818D2"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-reference-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-reference-current"><meta data-rh="true" property="og:title" content="Module Extensions | Reference | The Move Book"><link data-rh="true" rel="icon" href="/favicon.svg"><link data-rh="true" rel="canonical" href="https://move-book.com/reference/extensions"><link data-rh="true" rel="alternate" href="https://move-book.com/reference/extensions" hreflang="en"><link data-rh="true" rel="alternate" href="https://move-book.com/reference/extensions" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B1E7R0BHX4"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-B1E7R0BHX4",{anonymize_ip:!0})</script>



<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&amp;amp;display=swap">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><link rel="stylesheet" href="/assets/css/styles.4d9dba2f.css">
<script src="/assets/js/runtime~main.682f6591.js" defer="defer"></script>
<script src="/assets/js/main.08eca37e.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_OH5z" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"></a><a class="navbar__item navbar__link" href="/">Move Book</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reference">Move Reference</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_aspp"><div class="navbar__search searchBarContainer_reza" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_Kpxf" value=""><div class="loadingRing_LRD_ searchBarLoadingRing_lY7z"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/MystenLabs/move-book" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><i class="fab fa-github"></i></a><div class="toggle_MW0i colorModeToggle_RHuM"><button class="clean-btn toggleButton_yw5v toggleButtonDisabled_BJd7" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><i aria-hidden="true" class="toggleIcon_oIOL lightToggleIcon_SFTY fas fa-moon"></i><i aria-hidden="true" class="toggleIcon_oIOL darkToggleIcon_ekgs fas fa-sun"></i><i aria-hidden="true" class="toggleIcon_oIOL systemToggleIcon_yi_a fas fa-moon"></i></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_wWoK"><div class="docsWrapper_nrtX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_xs6u" type="button"></button><div class="docRoot_XRUv"><aside class="theme-doc-sidebar-container docSidebarContainer_vhZZ"><div class="sidebarViewport_HXJ_"><div class="sidebar_B2tA"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_RelJ"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reference/">The Move Reference</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Getting Started</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/modules">1. Modules</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Basic Concepts</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/reference/primitive-types">2. Primitive Types</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/primitive-types/integers">2.1 Integers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/primitive-types/bool">2.2 Bool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/primitive-types/address">2.3 Address</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/primitive-types/vector">2.4 Vector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/primitive-types/references">2.5 References</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/primitive-types/tuples">2.6 Tuples and Unit</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/variables">3. Local Variables and Scopes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/equality">4. Equality</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/reference/abort-and-assert">5. Abort and Assert</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/abort-and-assert/clever-errors">5.1 Clever Errors</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/reference/control-flow">6. Control Flow</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/control-flow/conditionals">6.1 Conditional Expressions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/control-flow/loops">6.2 Loops</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/control-flow/labeled-control-flow">6.3 Labeled Control Flow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/control-flow/pattern-matching">6.4 Pattern Matching</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/reference/functions">7. Functions</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/functions/macros">7.1 Macros</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/structs">8. Structs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/enums">9. Enums</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/constants">10. Constants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/generics">11. Generics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/abilities">12. Abilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/uses">13. Uses and Aliases</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Advanced Concepts</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/method-syntax">14. Method Syntax</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/index-syntax">15. Index Syntax</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active">Tooling</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/packages">16. Packages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/unit-testing">17. Unit Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/modes">18. Compilation Modes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/reference/extensions">19. Module Extensions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Reference</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/coding-conventions">20. Coding Conventions</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Deprecated</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reference/friends">21. Friends</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_oT2n"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_LCKf"><div class="docItemContainer_Jixr"><article><div class="tocCollapsible_vYTS theme-doc-toc-mobile tocMobile_QhsY"><button type="button" class="clean-btn tocCollapsibleButton_nB9w">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Module Extensions</h1></header>
<p><strong>Module Extensions</strong> let a package add new declarations to an existing module <strong>as if</strong> they were
defined inside that module. Extensions are opt-in via a mode attribute and never modify or remove
existing items.</p>
<h3 class="anchor anchorWithStickyNavbar_kl3l" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h3>
<p>Imagine you have an off-the-shelf module that you want to test in your package, but it
lacks some internal accessors or testing operations that would allow you to write full tests over
it. As a toy example, consider a simple counter module defined as a library:</p>
<div class="language-move codeBlockContainer_AE_o theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_YOHW"><pre tabindex="0" class="prism-code language-move codeBlock_q9R9 thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_bu_M"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token module-header module-keyword keyword" style="color:hsl(301, 63%, 40%)">module</span><span class="token module-header"> </span><span class="token module-header package-name constant" style="color:hsl(35, 99%, 36%)">counter</span><span class="token module-header double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token module-header module-name entity" style="color:#C18401">counter</span><span class="token module-header"> {</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token visibility keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token struct-or-enum-definition struct-keyword keyword" style="color:hsl(301, 63%, 40%)">struct</span><span class="token struct-or-enum-definition"> </span><span class="token struct-or-enum-definition struct-name entity" style="color:#C18401">Counter</span><span class="token struct-or-enum-definition"> </span><span class="token struct-or-enum-definition struct-has keyword" style="color:hsl(301, 63%, 40%)">has</span><span class="token struct-or-enum-definition"> </span><span class="token struct-or-enum-definition abilities support" style="color:#0184BC">drop</span><span class="token struct-or-enum-definition"> {</span><span class="token plain"> </span><span class="token property-name function-argument struct-property-name">value</span><span class="token plain">: </span><span class="token built-in-types support" style="color:#0184BC">u64</span><span class="token plain"> }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token visibility keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">new</span><span class="token plain">(): </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain"> { </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain"> { </span><span class="token property-name function-argument struct-property-name">value</span><span class="token plain">: </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain"> } }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token visibility keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">incr</span><span class="token plain">(</span><span class="token mut-keyword keyword" style="color:hsl(301, 63%, 40%)">mut</span><span class="token plain"> </span><span class="token property-name function-argument struct-property-name">c</span><span class="token plain">: </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain">): </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain"> {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        c.value = c.value + </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        c</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token visibility keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">destroy</span><span class="token plain">(</span><span class="token property-name function-argument struct-property-name">c</span><span class="token plain">: </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain">): </span><span class="token built-in-types support" style="color:#0184BC">u64</span><span class="token plain"> {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token let-keyword keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain"> { value } = c;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        value</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>You might use this module in your own package to implement a step counter:</p>
<div class="language-move codeBlockContainer_AE_o theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_YOHW"><pre tabindex="0" class="prism-code language-move codeBlock_q9R9 thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_bu_M"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token module-header module-keyword keyword" style="color:hsl(301, 63%, 40%)">module</span><span class="token module-header"> </span><span class="token module-header package-name constant" style="color:hsl(35, 99%, 36%)">app</span><span class="token module-header double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token module-header module-name entity" style="color:#C18401">step_counter</span><span class="token module-header"> {</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token use-import-fun use-keyword keyword" style="color:hsl(301, 63%, 40%)">use</span><span class="token use-import-fun"> counter</span><span class="token use-import-fun double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token use-import-fun">counter</span><span class="token use-import-fun double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token use-import-fun">{</span><span class="token use-import-fun capitalized-name entity" style="color:#C18401">Counter</span><span class="token use-import-fun">, new, incr, destroy};</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token struct-or-enum-definition enum-keyword keyword" style="color:hsl(301, 63%, 40%)">enum</span><span class="token struct-or-enum-definition"> </span><span class="token struct-or-enum-definition struct-name entity" style="color:#C18401">Step</span><span class="token struct-or-enum-definition"> { </span><span class="token struct-or-enum-definition struct-name entity" style="color:#C18401">Once</span><span class="token struct-or-enum-definition">, </span><span class="token struct-or-enum-definition struct-name entity" style="color:#C18401">Many</span><span class="token struct-or-enum-definition">(</span><span class="token built-in-types support" style="color:#0184BC">u64</span><span class="token plain">) }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token visibility keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">step</span><span class="token plain">(</span><span class="token property-name function-argument struct-property-name">c</span><span class="token plain">: </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain">, </span><span class="token property-name function-argument struct-property-name">s</span><span class="token plain">: </span><span class="token struct-types entity" style="color:#C18401">Step</span><span class="token plain">): </span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain"> {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token control-flow keyword" style="color:hsl(301, 63%, 40%)">match</span><span class="token plain"> s {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token struct-types entity" style="color:#C18401">Step</span><span class="token plain">::</span><span class="token struct-types entity" style="color:#C18401">Once</span><span class="token plain"> =&gt; </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">incr</span><span class="token plain">(c),</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            </span><span class="token struct-types entity" style="color:#C18401">Step</span><span class="token plain">::</span><span class="token struct-types entity" style="color:#C18401">Many</span><span class="token plain">(n) =&gt; {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token let-keyword keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> </span><span class="token mut-keyword keyword" style="color:hsl(301, 63%, 40%)">mut</span><span class="token plain"> c = c;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token let-keyword keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> </span><span class="token mut-keyword keyword" style="color:hsl(301, 63%, 40%)">mut</span><span class="token plain"> i = </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                </span><span class="token control-flow keyword" style="color:hsl(301, 63%, 40%)">while</span><span class="token plain"> (i &lt; n) {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    c = </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">incr</span><span class="token plain">(c);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                    i = i + </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">                c</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">            }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Suppose you wanted to write additional tests for this counter behavior, including ensuring
invariants and the ability to peek at the current value without consuming the counter. Extensions
allow you to add this behavior as test definitions in your own package without forking and updating
the downstream dependency.</p>
<div class="language-move codeBlockContainer_AE_o theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_YOHW"><pre tabindex="0" class="prism-code language-move codeBlock_q9R9 thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_bu_M"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token attribute attr-name" style="color:hsl(35, 99%, 36%)">#[test_only]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">extend </span><span class="token module-header module-keyword keyword" style="color:hsl(301, 63%, 40%)">module</span><span class="token module-header"> </span><span class="token module-header package-name constant" style="color:hsl(35, 99%, 36%)">counter</span><span class="token module-header double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token module-header module-name entity" style="color:#C18401">counter</span><span class="token module-header"> {</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:#A0A1A7">/// Peek at the current value without consuming the counter.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token visibility keyword" style="color:hsl(301, 63%, 40%)">public</span><span class="token plain"> </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">peek</span><span class="token plain">(</span><span class="token property-name function-argument struct-property-name">c</span><span class="token plain">: &amp;</span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain">): </span><span class="token built-in-types support" style="color:#0184BC">u64</span><span class="token plain"> { c.value }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(35, 99%, 36%)">#[test_only]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">extend </span><span class="token module-header module-keyword keyword" style="color:hsl(301, 63%, 40%)">module</span><span class="token module-header"> </span><span class="token module-header package-name constant" style="color:hsl(35, 99%, 36%)">app</span><span class="token module-header double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token module-header module-name entity" style="color:#C18401">step_counter</span><span class="token module-header"> {</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token use-import-fun use-keyword keyword" style="color:hsl(301, 63%, 40%)">use</span><span class="token use-import-fun"> counter</span><span class="token use-import-fun double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token use-import-fun">counter</span><span class="token use-import-fun double-colon punctuation" style="color:hsl(119, 34%, 47%)">::</span><span class="token use-import-fun">{</span><span class="token use-import-fun capitalized-name entity" style="color:#C18401">Counter</span><span class="token use-import-fun">, new, incr, peek};</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:#A0A1A7">// Local test helper to keep assertions tidy.</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">expect_value</span><span class="token plain">(</span><span class="token property-name function-argument struct-property-name">c</span><span class="token plain">: &amp;</span><span class="token struct-types entity" style="color:#C18401">Counter</span><span class="token plain">, </span><span class="token property-name function-argument struct-property-name">want</span><span class="token plain">: </span><span class="token built-in-types support" style="color:#0184BC">u64</span><span class="token plain">) { </span><span class="token macro-call macro-name support" style="color:#0184BC">assert</span><span class="token macro-call">!</span><span class="token plain">(c.</span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">peek</span><span class="token plain">() == want, </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">0</span><span class="token plain">); }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token comment" style="color:#A0A1A7">/// Equivalence: Once == Many(1).</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(35, 99%, 36%)">#[test]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    </span><span class="token function-keyword keyword" style="color:hsl(301, 63%, 40%)">fun</span><span class="token plain"> </span><span class="token function-name function" style="color:hsl(221, 87%, 60%)">once_equals_many1</span><span class="token plain">() {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token let-keyword keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> c1a = </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">step</span><span class="token plain">(</span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">new</span><span class="token plain">(), </span><span class="token struct-types entity" style="color:#C18401">Step</span><span class="token plain">::</span><span class="token struct-types entity" style="color:#C18401">Once</span><span class="token plain">);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token let-keyword keyword" style="color:hsl(301, 63%, 40%)">let</span><span class="token plain"> c1b = </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">step</span><span class="token plain">(</span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">new</span><span class="token plain">(), </span><span class="token struct-types entity" style="color:#C18401">Step</span><span class="token plain">::</span><span class="token struct-types entity" style="color:#C18401">Many</span><span class="token plain">(</span><span class="token literals number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">));</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">expect_value</span><span class="token plain">(&amp;c1a, </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">        </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">expect_value</span><span class="token plain">(&amp;c1b, </span><span class="token literals number" style="color:hsl(35, 99%, 36%)">1</span><span class="token plain">);</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    }</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>In this usage, you extend both the <span class="inline-code">counter::counter</span> module (to add helpers and tests) and the
<span class="inline-code">app::step_counter</span> module (to add tests for the step logic). All of this code lives in your
package, and it only affects test builds. The publishable code remains unchanged.</p>
<blockquote>
<p><strong>Note</strong>: Extensions can only add new items; they cannot modify or remove existing items. In &gt;
addition, only extensions defined in the root package are applied (extensions in dependencies are
not).</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_kl3l" id="extension-syntax">Extension Syntax<a href="#extension-syntax" class="hash-link" aria-label="Direct link to Extension Syntax" title="Direct link to Extension Syntax">​</a></h2>
<p>Extension are defined by adding the <span class="inline-code">extend</span> keyword before the <span class="inline-code">module</span> keyword:</p>
<div class="language-move codeBlockContainer_AE_o theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_YOHW"><pre tabindex="0" class="prism-code language-move codeBlock_q9R9 thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_bu_M"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token attribute attr-name" style="color:hsl(35, 99%, 36%)">#[mode(name1, name2, ...)]</span><span class="token plain">      </span><span class="token comment" style="color:#A0A1A7">// or #[test_only]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">extend </span><span class="token function-call function" style="color:hsl(221, 87%, 60%)">module</span><span class="token plain"> &lt;</span><span class="token built-in-types support" style="color:#0184BC">address</span><span class="token plain">&gt;::&lt;identifier&gt; {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    (&lt;use&gt; | &lt;type&gt; | &lt;function&gt; | &lt;constant&gt;)*</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Extensions are allowed for single-file module forms:</p>
<div class="language-move codeBlockContainer_AE_o theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_YOHW"><pre tabindex="0" class="prism-code language-move codeBlock_q9R9 thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_bu_M"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token attribute attr-name" style="color:hsl(35, 99%, 36%)">#[mode(test)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">extend module p&lt;</span><span class="token built-in-types support" style="color:#0184BC">address</span><span class="token plain">&gt;::&lt;identifier&gt;;</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">(&lt;use&gt; | &lt;type&gt; | &lt;function&gt; | &lt;constant&gt;)*</span><br></span></code></pre></div></div>
<p>In both cases:</p>
<ul>
<li>The extension must define a mode attribute.</li>
<li><span class="inline-code">&lt;address&gt;::&lt;identifier&gt;</span> is the package and module name.</li>
<li>The module elements are as in a standard <a href="/reference/modules">module</a>.</li>
<li>The extension block is compiled into the target module under the enabled modes.</li>
<li><span class="inline-code">&lt;address&gt;::&lt;identifier&gt;</span> must resolve to an existing module in the current build.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_kl3l" id="applying-extensions">Applying Extensions<a href="#applying-extensions" class="hash-link" aria-label="Direct link to Applying Extensions" title="Direct link to Applying Extensions">​</a></h2>
<p>Let <span class="inline-code">M</span> be a module in the current build. Let <span class="inline-code">E1, E2, ... En</span> be all extensions targeting <span class="inline-code">M</span> such
that:</p>
<ul>
<li><span class="inline-code">Ei</span> is defined in the root package of the current build (others are ignored).</li>
<li><span class="inline-code">Ei</span> targets <span class="inline-code">M</span></li>
<li><span class="inline-code">Ei</span> has an active mode attribute.</li>
</ul>
<p>During expansion, the effective contents of <span class="inline-code">M</span> are transformed into:</p>
<div class="language-text codeBlockContainer_AE_o theme-code-block" style="--prism-background-color:hsl(230, 1%, 98%);--prism-color:hsl(230, 8%, 24%)"><div class="codeBlockContent_YOHW"><pre tabindex="0" class="prism-code language-text codeBlock_q9R9 thin-scrollbar" style="background-color:hsl(230, 1%, 98%);color:hsl(230, 8%, 24%)"><code class="codeBlockLines_bu_M"><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">module M {</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ... original contents of M ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ... contents of E1 ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ... contents of E2 ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">    ... contents of En ...</span><br></span><span class="token-line" style="color:hsl(230, 8%, 24%)"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Name resolution, visibility, edition rules, type checking, etc., are applied to the resultant
module as a whole. This means each declaration in an extension is treated as if it were written
directly in the target module, and subject to the same visibility, edition features, duplicate
definition errors, name conflicts, etc.</p>
<p>This means that extensions may not modify or override existing declarations, and may not shadow
existing <span class="inline-code">use</span> definitions, etc. New use definitions may be added, but their compilation is still
subject to decidable dependency ordering, as described in the <a href="/reference/uses"><span class="inline-code">use</span></a> section.</p>
<blockquote>
<p><strong>Tip</strong>: Extension code is subject of the same edition features as the target module. If the
target module is in an older edition, the extension code must also be compatible with that
edition.</p>
</blockquote></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/reference/modes"><div class="pagination-nav__label"><i class="fa fa-angle-left"></i><span class="pagination-nav__label">18. Compilation Modes</span> </div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reference/coding-conventions"><div class="pagination-nav__label"><span class="pagination-nav__label">20. Coding Conventions</span> <i class="fa fa-angle-right"></i></div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_VdoB thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#extension-syntax" class="table-of-contents__link toc-highlight">Extension Syntax</a></li><li><a href="#applying-extensions" class="table-of-contents__link toc-highlight">Applying Extensions</a></li></ul></div></div></div></div></main></div></div></div></div>
</body>
</html>